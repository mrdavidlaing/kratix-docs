"use strict";(self.webpackChunkkratix_docs=self.webpackChunkkratix_docs||[]).push([[8150],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>d});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),l=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},k=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(a),k=r,d=u["".concat(c,".").concat(k)]||u[k]||m[k]||o;return a?n.createElement(d,i(i({ref:t},p),{},{components:a})):n.createElement(d,i({ref:t},p))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=k;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[u]="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=a[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},6022:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>c,toc:()=>p});var n=a(7462),r=(a(7294),a(3905)),o=a(4996);const i={description:"Documentation for using Backstage with Kratix",title:"Backstage",sidebar_label:"Backstage",id:"intro"},s=void 0,c={unversionedId:"main/reference/backstage/intro",id:"main/reference/backstage/intro",title:"Backstage",description:"Documentation for using Backstage with Kratix",source:"@site/docs/main/05-reference/07-backstage/01-backstage.md",sourceDirName:"main/05-reference/07-backstage",slug:"/main/reference/backstage/intro",permalink:"/docs/main/reference/backstage/intro",draft:!1,editUrl:"https://github.com/syntasso/kratix-docs/tree/main/docs/main/05-reference/07-backstage/01-backstage.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{description:"Documentation for using Backstage with Kratix",title:"Backstage",sidebar_label:"Backstage",id:"intro"},sidebar:"mainSidebar",previous:{title:"BucketStateStore",permalink:"/docs/main/reference/statestore/bucketstatestore"},next:{title:"Multi-cluster management",permalink:"/docs/main/reference/multicluster-management"}},l={},p=[{value:"What",id:"what",level:2},{value:"Why",id:"why",level:2},{value:"How",id:"how",level:2},{value:"Setting up Kratix with Backstage",id:"setting-up-kratix-with-backstage",level:3},{value:"Create Backstage Resources with Kratix",id:"create-backstage-resources-with-kratix",level:3},{value:"Support",id:"support",level:3}],u={toc:p};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},(0,r.kt)("a",{parentName:"em",href:"https://backstage.io/"},"Backstage")," is a framework for building developer portals. Kratix is a framework for building platforms. It's as if they were made for each other.")),(0,r.kt)("img",{align:"right",src:(0,o.Z)("/img/k+backstage.png"),style:{float:"right",width:"400px",margin:"20px 0 40px 40px"},alt:"Kratix logo and Backstage logo"}),(0,r.kt)("h2",{id:"what"},"What"),(0,r.kt)("p",null,"Backstage and Kratix both believe that the most powerful platforms must be built\nby each organisation. While each platform needs to be custom-built, both tools also\nencourage building on top of community-provided support where possible. Together, the two\nprovide a framework for platform engineers which places user experience front and center."),(0,r.kt)("p",null,"Backstage is a framework that enables GUIs to be declaratively created with the\naim of unifying infrastructure tooling, services, and documentation to produce a\nstellar developer experience. It's completely un-opinionated and decoupled from how\nyou drive your platform infrastructure."),(0,r.kt)("p",null,"Kratix enables platform teams to declare platform APIs that orchestrates\nworkloads across your infrastructure. Kratix does not come with a packaged GUI."),(0,r.kt)("h2",{id:"why"},"Why"),(0,r.kt)("p",null,"This divide between GUI and API makes Backstage and Kratix the perfect package."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Decoupled architecture:")),(0,r.kt)("p",{parentName:"li"},"GUI architectures shine when their responsibility is limited to the UX\nexperience. Rather than define your platform orchestartation in Backstage\ndirectly, you can have Backstage call the Kratix API which provides easier\nportability across GUIs, while still supporting the experience of more CLI-driven\nusers. Plus, decoupling enables easier refactoring of platfom implementation due to\nstable API definitions.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Auto-populated GUI:")),(0,r.kt)("p",{parentName:"li"},"Backstage GUIs must be declared, which is toil for the platform. Kratix can\nreduce this toil by integrating ",(0,r.kt)("a",{parentName:"p",href:"/docs/main/reference/promises/intro"},"Promises")," with\nBackstage by default. In addition, these GUIs can diverge from platform\nofferings if they are managed separately from the backend implementations.\nPromises that define the API and the Backstage GUI at the same time provide\nautomatic support for iterations on your platform's offerings."))),(0,r.kt)("h2",{id:"how"},"How"),(0,r.kt)("p",null,"Integrating Backstage with Kratix is simple. Point Backstage at the Kratix\nplatform cluster, and that's it. Kratix will then build the Backstage views as\nPromises are loaded into Kratix, and Resources are requested by users of the\nplatform."),(0,r.kt)("p",null,"With Kratix, you get declarative UIs by default:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The Backstage Catalog is automatically populated when Kratix Promises are\napplied."),(0,r.kt)("li",{parentName:"ul"},"Templates for Promises are automatically created when Promises are loaded.\nThis provides consumers of the platform with a simple, predictable UX to create\nResources from the Promises they require. This could be entire paved-path environments,\nor simply instances of services developers need. See our selection of Promises on our\n",(0,r.kt)("a",{parentName:"li",href:"https://www.kratix.io/marketplace"},"Marketplace"),"."),(0,r.kt)("li",{parentName:"ul"},"Due to Kratix's powerful GitOps abstractions, the Backstage configuration data\nlives outside of Backstage, leaving your Kratix-driven Backstage ephemeral in\nnature. If your Backstage dies, no problem: redeploy it and your views will\nautomatically be brought back to life by Kratix.")),(0,r.kt)("br",null),(0,r.kt)("div",{style:{"text-align":"center"}},(0,r.kt)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/wj5VaXYTvrg",title:"Use Kratix to provide on-demand services through a Backstage UI",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0})),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"setting-up-kratix-with-backstage"},"Setting up Kratix with Backstage"),(0,r.kt)("p",null,"Backstage supports reading objects from S3-compatible blob stores. Kratix\nalso supports writing to them."),(0,r.kt)("p",null,"To set up this integration, you'll need to create a\n",(0,r.kt)("a",{parentName:"p",href:"/docs/main/reference/statestore/bucketstatestore"},"BucketStateStore")," and a\n",(0,r.kt)("a",{parentName:"p",href:"/docs/main/reference/destinations/intro"},"Destination")," which points to the\ndirectory that Backstage is configured to watch."),(0,r.kt)("p",null,"For example, first create a ",(0,r.kt)("inlineCode",{parentName:"p"},"BucketStateStore")," for Backstage to use:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: platform.kratix.io/v1alpha1\nkind: BucketStateStore\nmetadata:\n  name: backstage\nspec:\n  bucketName: kratix\n  endpoint: s3.amazonaws.com\n  insecure: false\n  path: backstage/\n  secretRef:\n    name: s3-credentials\n    namespace: default\n")),(0,r.kt)("p",null,"And a ",(0,r.kt)("inlineCode",{parentName:"p"},"backstage")," Destination in Kratix to enable Promises to write to the state store:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: platform.kratix.io/v1alpha1\nkind: Destination\nmetadata:\n  labels:\n    environment: backstage\n  name: backstage\nspec:\n  stateStoreRef:\n    kind: BucketStateStore\n    name: backstage\n")),(0,r.kt)("p",null,"At this point, the Kratix half of the partnership is set up: we have a state store, and we\ncan write to it. We now need to configure Backstage to read from this state store."),(0,r.kt)("p",null,"To do this, you can update your ",(0,r.kt)("a",{parentName:"p",href:"https://backstage.io/docs/conf/"},"Backstage configuration"),"\nas follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"integrations:\n  awsS3:\n    - endpoint: 'http://s3.amazonaws.com'\n      s3ForcePathStyle: true\n      accessKeyId: ${AWS_ACCESS_KEY_ID}\n      secretAccessKey: ${AWS_SECRET_ACCESS_KEY}\ncatalog:\n  providers:\n    awsS3:\n      kratix-bucket:\n        bucketName: kratix\n        prefix: backstage/\n        region: us-east-2\n        schedule:\n          frequency: {minutes: 1}\n          timeout: {seconds: 20}\n\n")),(0,r.kt)("p",null,"Backstage is now configured to load any Backstage documents, such as templates\nand components, which Kratix has written to the state store."),(0,r.kt)("h3",{id:"create-backstage-resources-with-kratix"},"Create Backstage Resources with Kratix"),(0,r.kt)("p",null,"Kratix ",(0,r.kt)("a",{parentName:"p",href:"../workflows"},"workflows")," allow Promise authors to define pipelines that\nrun at various points in the lifecycle of a ",(0,r.kt)("a",{parentName:"p",href:"/docs/main/reference/resources/workflows"},"Resource")," or\n",(0,r.kt)("a",{parentName:"p",href:"/docs/main/reference/promises/workflows"},"Promise"),". These workflows can output documents of\n",(0,r.kt)("em",{parentName:"p"},"any type"),", and a single workflow can schedule to\n",(0,r.kt)("a",{parentName:"p",href:"../multicluster-management#dynamic"},"multiple destinations"),"."),(0,r.kt)("p",null,"This powerful combination enables Promise authors to output many distinct types of\nresource to its own destination, all in a single workflow. In this case, we're writing\nboth Kubernetes manifests and Backstage components and templates, ensuring that the latter\nare only picked up by Backstage."),(0,r.kt)("p",null,"The Promise Configure workflow can be used to output a component and template for the\nPromise at installation time, and then the Resource Configure workflow can output a\ncomponent to describe what has been provisioned. The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/syntasso/kratix-marketplace/tree/main/kafka"},"Kafka\nPromise")," in our\nMarketplace demonstrates this."),(0,r.kt)("p",null,"The Promise Configure workflow for Kafka outputs the Kafka operator for deployment to a\nKubernetes cluster (the default scheduling for this Promise) and then outputs a\ncomponent and template separately for Backstage, specifying the scheduling to\nensure it goes to the Backstage destination:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'#!/usr/bin/env sh\n\nset -x\n\n\n# Copy the Operator manifest\ncp -r /tmp/transfer/dependencies/* /kratix/output/\n\n# Copy the Backstage resources\ncp -r /tmp/transfer/backstage /kratix/output\n\n# Ensure the contents of the /kratix/output/backstage/\n# directory go to the Backstage Destination\necho """\n- directory: backstage\n  matchLabels:\n    environment: backstage\n""" >> /kratix/metadata/destination-selectors.yaml\n')),(0,r.kt)("p",null,"The sample component and template can be found\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/syntasso/kratix-marketplace/blob/main/kafka/internal/configure-promise-pipeline/resources/backstage/backstage.yaml"},"here"),".\nThe Template takes advantage of the\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/muvaf/kubernetes-apply"},"kubernetes-apply")," Backstage plugin to\n",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl apply")," the desired resource directly to the Platform cluster. Any plugin can be\nused which enables the request to make its way to the Platform cluster; for example,\ninstead of hitting the cluster directly, it could commit or open a PR to a GitHub\nrepository that is being used to deploy resources to the Platform cluster via GitOps."),(0,r.kt)("p",null,"Once Kratix and Backstage are wired up, Backstage will read from the Destination and\npopulate the UI as shown below:"),(0,r.kt)("img",{src:(0,o.Z)("/img/docs/backstage-promise.png")}),(0,r.kt)("p",null,"A user can then make a ",(0,r.kt)("a",{parentName:"p",href:"/docs/main/reference/resources/intro"},"Resource request"),' to Kratix by\nclicking "Create" in the top right, selecting the Kafka form and filling out the details:'),(0,r.kt)("img",{src:(0,o.Z)("/img/docs/backstage-template.png")}),(0,r.kt)("p",null,"The last step is to ensure that a component in Backstage appears to represent the Resource\nthe user requested. The Kafka Promise achieves this as part of the Resource workflow, as\nshown below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'#!/usr/bin/env sh\n\nset -eux\n\n# Read current values from the provided resource request\nexport name="$(yq eval \'.metadata.name\' /kratix/input/object.yaml)"\n\n...\n\nmkdir -p /kratix/output/backstage/\n\ncat <<EOF > /kratix/output/backstage/component.yaml\napiVersion: backstage.io/v1alpha1\nkind: Component\nmetadata:\n  name: kafka-${name}\n  title: "Kafka ${name}"\n  description: Kafka created via the Promise\n  annotations:\n    backstage.io/kubernetes-label-selector: kafka=${name}\n  links:\n  - url: https://github.com/syntasso/kratix-marketplace\n    title: Support\n    icon: help\nspec:\n  type: service\n  lifecycle: production\n  owner: kratix-worker\n  dependsOn:\n    - component:default/kafka\n  providesApis:\n    - kafka-promise-api\nEOF\n\necho """\n- directory: backstage\n  matchLabels:\n    environment: backstage\n""" >> /kratix/metadata/destination-selectors.yaml\n')),(0,r.kt)("p",null,"This results in the instance being displayed in Backstage:"),(0,r.kt)("img",{src:(0,o.Z)("/img/docs/backstage-resource.png")}),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"support"},"Support"),(0,r.kt)("p",null,"Having difficulties with Backstage and Kratix? Get in touch with us at\n",(0,r.kt)("a",{parentName:"p",href:"mailto:feedback@syntasso.io?subject=Kratix%20Feedback"},"feedback@syntasso.io")," or\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/syntasso/kratix/issues/new"},"open a GitHub Issue"),"."))}m.isMDXComponent=!0}}]);