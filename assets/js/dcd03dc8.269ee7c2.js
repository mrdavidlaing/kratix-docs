"use strict";(self.webpackChunkkratix_docs=self.webpackChunkkratix_docs||[]).push([[5757],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},k=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=u(n),k=r,d=c["".concat(s,".").concat(k)]||c[k]||m[k]||l;return n?a.createElement(d,i(i({ref:t},p),{},{components:n})):a.createElement(d,i({ref:t},p))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=k;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:r,i[1]=o;for(var u=2;u<l;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}k.displayName="MDXCreateElement"},4051:(e,t,n)=>{n.d(t,{ZP:()=>i});var a=n(7462),r=(n(7294),n(3905));const l={toc:[{value:"Pre-requisites",id:"pre-requisites",level:4}]};function i(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h4",{id:"pre-requisites"},"Pre-requisites"),(0,r.kt)("details",null,(0,r.kt)("summary",null,"You need an installation of Kratix for this section. ",(0,r.kt)("strong",null,"Click here")," for instructions"),(0,r.kt)("p",null,"The simplest way to do so is by running the quick-start script from within the\nKratix directory. The script will create two KinD clusters, install, and\nconfigure Kratix."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./scripts/quick-start.sh --recreate\n")),(0,r.kt)("p",null,"You can run Kratix either with a multi-cluster or a single-cluster setup. The\ncommands on the remainder of this document assume that two environment variables\nare set:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"PLATFORM")," representing the platform cluster Kubernetes context"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"WORKER")," representing the worker cluster Kubernetes context")),(0,r.kt)("p",null,"If you ran the quick-start script above, do:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'export PLATFORM="kind-platform"\nexport WORKER="kind-worker"\n')),(0,r.kt)("p",null,"For single cluster setups, the two variables should be set to the same value.\nYou can find your cluster context by running:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl config get-contexts\n")),(0,r.kt)("p",null,"Refer back to ",(0,r.kt)("a",{parentName:"p",href:"../../category/installing-kratix"},"Installing Kratix")," for more\ndetails.")))}i.isMDXComponent=!0},3714:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>p,default:()=>h,frontMatter:()=>u,metadata:()=>c,toc:()=>k});var a=n(7462),r=(n(7294),n(3905)),l=n(4051);const i=[{value:"What is a Kratix Promise?",id:"what-is-a-kratix-promise",level:2},{value:"Kratix Promises",id:"kratix-promises",level:2},{value:"Install the Kratix sample Jenkins Promise",id:"install-the-kratix-sample-jenkins-promise",level:2},{value:"Install the Jenkins Promise",id:"install-the-jenkins-promise",level:3},{value:"Request a Jenkins Resource",id:"request-resource",level:3},{value:"Use your Jenkins",id:"use-your-jenkins",level:3},{value:"Summary",id:"summary",level:2},{value:"Clean up environment",id:"cleanup",level:2},{value:"\ud83c\udf89 \xa0 Congratulations!",id:"--congratulations",level:2}],o={toc:i};function s(e){let{components:t,...l}=e;return(0,r.kt)("wrapper",(0,a.Z)({},o,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"In this guide, you will")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#what-is-a-kratix-promise"},"learn more about Kratix Promises")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#install-the-kratix-sample-jenkins-promise"},"install Jenkins as a Kratix Promise"))),(0,r.kt)("h2",{id:"what-is-a-kratix-promise"},"What is a Kratix Promise?"),(0,r.kt)("p",null,"Conceptually, Promises are the building blocks of Kratix that allow you to\ndevelop your platform incrementally. Technically, a Promise is a YAML document\nthat defines a contract between the Platform and its users. You can explore\nmore about this contract and the internals of a Kratix Promise in the ",(0,r.kt)("a",{parentName:"p",href:"writing-a-promise"},"writing\na Promise")," guide."),(0,r.kt)("h2",{id:"kratix-promises"},"Kratix Promises"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"enable you to build your platform incrementally and in response to the needs of your users."),(0,r.kt)("li",{parentName:"ul"},"codify the contract between platform teams and application teams for the delivery of a specific service, e.g. a database, an identity service, a supply chain, or a complete development workflow including patterns and tools."),(0,r.kt)("li",{parentName:"ul"},"are easy to build, deploy, and update."),(0,r.kt)("li",{parentName:"ul"},"are shareable and reusable between platforms, teams, business units, and other organisations."),(0,r.kt)("li",{parentName:"ul"},"add up to a frictionless experience when platform users want to create services that they need to deliver value.")),(0,r.kt)("p",null,"Now that you know more about Kratix Promises, follow the steps below to install a Promise."),(0,r.kt)("br",null),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"install-the-kratix-sample-jenkins-promise"},"Install the Kratix sample Jenkins Promise"),(0,r.kt)("p",null,"Now that your system is set up, you can install your first Kratix Promise! This guide will follow the steps below:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#install-the-jenkins-promise"},"Install the Jenkins Promise")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#request-resource"},"Request a new Jenkins Resource")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#use-your-jenkins-resource"},"Use the Jenkins")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#cleanup"},"Clean up environment"))),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Overview",src:n(9840).Z,width:"4909",height:"3258"})),(0,r.kt)("h3",{id:"install-the-jenkins-promise"},"Install the Jenkins Promise"),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"In this guide, we will be using Promises available on the ",(0,r.kt)("a",{parentName:"p",href:"/marketplace"},"Kratix Marketplace"),".\nThe commands below will refer to a ",(0,r.kt)("inlineCode",{parentName:"p"},"KRATIX_MARKETPLACE_REPO")," env variable. You can either:"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"clone the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/syntasso/kratix-marketplace"},"Kratix Marketplace")," and set it to the path of your local clone:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"export KRATIX_MARKETPLACE_REPO=/path/to/kratix-marketplace\n"))),(0,r.kt)("li",{parentName:"ul"},"set it to a remote URL:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'export KRATIX_MARKETPLACE_REPO="https://raw.githubusercontent.com/syntasso/kratix-marketplace/main"\n'))))),(0,r.kt)("p",null,"Installing a Kratix Promise is as simple as applying the Promise YAML definition on your platform cluster:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl --context $PLATFORM apply \\\n  --filename "${KRATIX_MARKETPLACE_REPO}/jenkins/promise.yaml"\n')),(0,r.kt)("br",null),(0,r.kt)("p",null,"Verify that your ",(0,r.kt)("inlineCode",{parentName:"p"},"platform")," cluster has registered Jenkins as a new available Kratix Promise."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl --context $PLATFORM get crds jenkins.marketplace.kratix.io\n")),(0,r.kt)("p",null,"The above command will give an output similar to"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"NAME                            CREATED AT\njenkins.marketplace.kratix.io   2021-05-10T12:00:00Z\n")),(0,r.kt)("br",null),(0,r.kt)("p",null,"The Jenkins Promise requires the Jenkins Operator to be deployed to the ",(0,r.kt)("code",null,"worker")," Destination clusters. Kratix will deploy the operator when you apply the Promise. You can verify that the Jenkins Operator is now installed",(0,r.kt)("br",null),(0,r.kt)("sub",null,"(This may take a few minutes so ",(0,r.kt)("code",null,"--watch")," will watch the command. Press ",(0,r.kt)("kbd",null,"Ctrl"),"+",(0,r.kt)("kbd",null,"C")," to stop watching)")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl --context $WORKER get pods --watch\n")),(0,r.kt)("p",null,"The above command will give an output similar to (it may take a couple of minutes):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"NAME                                READY   STATUS    RESTARTS   AGE\njenkins-operator-7886c47f9c-zschr   1/1     Running   0          1m\n")),(0,r.kt)("br",null),(0,r.kt)("p",null,"\ud83c\udf89  Congratulations! You have installed your first Kratix Promise, which means your application teams can now get on-demand Jenkins from your platform."),(0,r.kt)("h3",{id:"request-resource"},"Request a Jenkins Resource"),(0,r.kt)("p",null,"Application developers using your platform will be issued a Jenkins after requesting a new Resource."),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Verify-Instance",src:n(3283).Z,width:"5365",height:"2981"})),(0,r.kt)("p",null,"Test your platform by acting as an application developer and submitting a request for a Resource:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl --context $PLATFORM apply \\\n    --filename "${KRATIX_MARKETPLACE_REPO}/jenkins/resource-request.yaml"\n')),(0,r.kt)("br",null),(0,r.kt)("p",null,"Verify that the request was issued on the ",(0,r.kt)("inlineCode",{parentName:"p"},"platform")," cluster."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl --context $PLATFORM get jenkins.marketplace.kratix.io\n")),(0,r.kt)("p",null,"The above command will give an output similar to"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"NAME      STATUS\nexample   Resource requested\n")),(0,r.kt)("p",null,"Eventually (it can take a couple of minutes), a new Jenkins should spin up on your ",(0,r.kt)("inlineCode",{parentName:"p"},"worker")," Destination cluster. You can verify this by running the following command:"),(0,r.kt)("p",null,"Verify the Jenkins was created on the worker cluster",(0,r.kt)("br",null),(0,r.kt)("sub",null,"(This may take a few minutes so ",(0,r.kt)("code",null,"--watch")," will watch the command. Press ",(0,r.kt)("kbd",null,"Ctrl"),"+",(0,r.kt)("kbd",null,"C")," to stop watching)")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl --context $WORKER get pods --watch\n")),(0,r.kt)("p",null,"The above command will give an output similar to"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"NAME                                READY   STATUS    RESTARTS   AGE\njenkins-dev-example                 1/1     Running   0          1m\njenkins-operator-7886c47f9c-zschr   1/1     Running   0          10m\n")),(0,r.kt)("br",null),(0,r.kt)("p",null,"\ud83c\udf89  Congratulations! You have successfully requested and created an on-demand Jenkins from your platform."),(0,r.kt)("h3",{id:"use-your-jenkins"},"Use your Jenkins"),(0,r.kt)("p",null,"Access the UI in a browser to ensure the Jenkins is working."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Before you can access Jenkins UI, you must port forward from within the Kubernetes cluster to a local port on your computer. Running the ",(0,r.kt)("inlineCode",{parentName:"p"},"port-forward")," command is continuous","\u2014","as long as the command is running, the connection stays open."),(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"Open a new terminal to request the port forward")),"."),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-console"},"kubectl --context $WORKER port-forward jenkins-dev-example 8080:8080\n"))),(0,r.kt)("p",null,"You can find Jenkins credentials by running:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console",metastring:'jsx title="username"',jsx:!0,title:'"username"'},"kubectl --context $WORKER get secret jenkins-operator-credentials-dev-example \\\n    -o 'jsonpath={.data.user}' | base64 -d\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console",metastring:'jsx title="password"',jsx:!0,title:'"password"'},"kubectl --context $WORKER get secret jenkins-operator-credentials-dev-example \\\n    -o 'jsonpath={.data.password}' | base64 -d\n")),(0,r.kt)("p",null,"Navigate to ",(0,r.kt)("a",{parentName:"p",href:"http://localhost:8080"},"http://localhost:8080")," and log in with the\ncredentials. In production, you want the credentials to be stored in a secure\nlocation where it could be accessed by the application team. In this example,\ncredentials are stored as unencrypted Kubernetes secrets."),(0,r.kt)("h2",{id:"summary"},"Summary"),(0,r.kt)("p",null,"You installed your first Kratix Promise on your platform. Well done!"),(0,r.kt)("p",null,"To recap the steps you took:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u2705","\xa0","\xa0","Installed the sample Jenkins Promise"),(0,r.kt)("li",{parentName:"ol"},"\u2705","\xa0","\xa0","Requested an Jenkins Resource"),(0,r.kt)("li",{parentName:"ol"},"\u2705","\xa0","\xa0","Tested the Jenkins by logging in to the Jenkins UI")),(0,r.kt)("p",null,"This is only the beginning of working with Promises. Next you will deploy three different Promises to provide a complete solution for an application team."),(0,r.kt)("h2",{id:"cleanup"},"Clean up environment"),(0,r.kt)("p",null,"To clean up your environment you need to delete the Jenkins Resources and the Jenkins Promise."),(0,r.kt)("p",null,"To delete the Jenkins Resources:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl --context $PLATFORM delete \\\n    --filename "${KRATIX_MARKETPLACE_REPO}/jenkins/resource-request.yaml"\n')),(0,r.kt)("p",null,"Verify the Jenkins Resource in the platform cluster is gone"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"kubectl --context $PLATFORM get jenkins\n")),(0,r.kt)("p",null,"and the Jenkins workloads in the worker cluster have been deleted"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"kubectl --context $WORKER get pods\n")),(0,r.kt)("p",null,"The above command will give an output similar to (it may take a couple of minutes)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"NAME                                READY   STATUS    RESTARTS   AGE\njenkins-operator-7886c47f9c-zschr   1/1     Running   0          1m\n")),(0,r.kt)("p",null,"Now you can delete the Jenkins Promise"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl --context $PLATFORM delete \\\n  --filename "${KRATIX_MARKETPLACE_REPO}/jenkins/promise.yaml"\n')),(0,r.kt)("p",null,"Verify the Jenkins Promise is gone"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"kubectl --context $PLATFORM get promises\n")),(0,r.kt)("p",null,"and the Jenkins Operator is deleted from the worker cluster (this might take a couple minutes)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"kubectl --context $WORKER get pods\n")),(0,r.kt)("p",null,"Alternatively, you could delete the Promise directly. By default Kratix will delete all child Resources when a Promise is deleted. For more details, check the ",(0,r.kt)("a",{parentName:"p",href:"/docs/main/reference/promises/delete"},"deletion\nreference docs")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"--congratulations"},"\ud83c\udf89 ","\xa0"," Congratulations!"),(0,r.kt)("p",null,"\u2705","\xa0","\xa0"," You have installed a Kratix Promise and used it to create on-demand Resources. ",(0,r.kt)("br",null),"\n\ud83d\udc49","\xa0","\xa0"," Now you will ",(0,r.kt)("a",{parentName:"p",href:"writing-a-promise"},"write your own Promise"),"."))}s.isMDXComponent=!0;const u={title:"Installing and using a Promise",description:"Step by step guide to install Kratix and your first Promise."},p="Installing and using a Promise",c={unversionedId:"main/guides/installing-a-promise",id:"main/guides/installing-a-promise",title:"Installing and using a Promise",description:"Step by step guide to install Kratix and your first Promise.",source:"@site/docs/main/04-guides/02-installing-a-promise.md",sourceDirName:"main/04-guides",slug:"/main/guides/installing-a-promise",permalink:"/docs/main/guides/installing-a-promise",draft:!1,editUrl:"https://github.com/syntasso/kratix-docs/tree/main/docs/main/04-guides/02-installing-a-promise.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Installing and using a Promise",description:"Step by step guide to install Kratix and your first Promise."},sidebar:"mainSidebar",previous:{title:"Single cluster",permalink:"/docs/main/guides/installing-kratix/single-cluster"},next:{title:"Writing a Promise",permalink:"/docs/main/guides/writing-a-promise"}},m={},k=[...i],d={toc:k};function h(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"installing-and-using-a-promise"},"Installing and using a Promise"),(0,r.kt)(l.ZP,{mdxType:"PartialGuidesPreRequisites"}),(0,r.kt)(s,{mdxType:"GuideInstallPromise"}))}h.isMDXComponent=!0},3283:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/kratix_diagrams-Get_Instance-fb97a5db7d814c2eafb61a4b3f5422e4.jpg"},9840:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/kratix_diagrams-Install_Promise-68d647afd2c1d34a05bf75c921e99f05.jpg"}}]);